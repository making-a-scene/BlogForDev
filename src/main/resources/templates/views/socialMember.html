<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <title>소셜로그인 화면</title>
  <meta name="description" content=""/>
  <meta name="viewport" content="width=device-width"/>
  <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
  <base href="/"/>
<<<<<<< HEAD
=======
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <meta name="_csrf" th:content="${_csrf.token}">
>>>>>>> origin/postlist
</head>
<h1> 기존 회원 </h1>

<div sec:authorize="hasRole('USER')">

  Logged in as: <div th:text="${nickname}"></div>
  <label for="changeNickname"> 닉네임 변경하기 :  </label>
  <input type="text" th:placeholder="${nickname}" id="changeNickname">
  <button id="update-nickname" th:onclick="changeNickName()"> 변경하기 </button>

  <label for="changeBlogName"> 블로그 변경하기 :  </label>
  <input type="text" th:placeholder="${blogname}" id="changeBlogName">
  <button id="update-blogName" th:onclick="changeBlogName()"> 변경하기 </button>

  <a th:href="@{/logout}">로그아웃</a>
  <button id="delete-btn" th:onclick="deleteID([[${name}]])">삭제</button>
</div>
<script type="text/javascript">

    function changeNickName(){
    let nickname = document.getElementById("changeNickname").value;
    const url = "/user/changeNickName";
<<<<<<< HEAD
=======
    var header = $("meta[name='_csrf_header']").attr('content');
    var token = $("meta[name='_csrf']").attr('content');
>>>>>>> origin/postlist
    $.ajax({
    type:'put',
    url:url,
    data:nickname,
<<<<<<< HEAD
=======
    beforeSend: function(xhr){
        xhr.setRequestHeader(header, token);
    },
>>>>>>> origin/postlist
    success: function(res) {
        console.log(res);
    },
    contentType:"application/JSON; charset=UTF-8"
    }).done(function() {
    alert('닉네임이 업데이트 되었습니다.');
    window.location.reload();
    }).fail(function (error){
    alert(JSON.stringify(error));
    });
    }

    function changeBlogName(){
    let blogname = document.getElementById("changeBlogName").value;
    const url = "/user/changeBlogName";
<<<<<<< HEAD
=======
    var header = $("meta[name='_csrf_header']").attr('content');
    var token = $("meta[name='_csrf']").attr('content');
>>>>>>> origin/postlist
    $.ajax({
    type:'put',
    url:url,
    data:blogname,
<<<<<<< HEAD
=======
    beforeSend: function(xhr){
        xhr.setRequestHeader(header, token);
    },
>>>>>>> origin/postlist
    success: function(res) {
        console.log(res);
    },
    contentType:"application/JSON; charset=UTF-8"
    }).done(function() {
    alert('블로그명이 업데이트 되었습니다.');
    window.location.reload();
    }).fail(function (error){
    alert(JSON.stringify(error));
    });
    }

    function deleteID(name){
    const url = "/user/delete/"+name;
<<<<<<< HEAD
    $.ajax({
    type:'delete',
    url:url,
=======
    var header = $("meta[name='_csrf_header']").attr('content');
    var token = $("meta[name='_csrf']").attr('content');
    $.ajax({
    type:'delete',
    url:url,
    beforeSend: function(xhr){
        xhr.setRequestHeader(header, token);
    },
>>>>>>> origin/postlist
    success: function(res) {
        console.log(res);
    },
    contentType:"application/JSON; charset=UTF-8"
    }).done(function() {
    alert('탈퇴 처리 되었습니다.');
    window.location.href = '/social';
    }).fail(function (error){
    alert(JSON.stringify(error));
    });
    }


</script>
</body>
</html>